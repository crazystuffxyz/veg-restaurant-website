$(document).ready((function(){const e=5,t=$("#reviewsList"),r=$("#loadingReviews"),a=$("#reviewForm"),s=$("#reviewMessage"),n=$("#submitReviewButton"),l=$("#reviewButtonText"),o=$("#reviewButtonSpinner"),i=$("#rating-error"),d=$("#paginationControls"),c=$("#prevPageButton"),p=$("#nextPageButton"),m=$("#pageInfo");let u=[],v=1,h=1;function g(){if(t.empty(),r.hide(),0===u.length)return t.html('<p class="text-center text-neutral-light/70 py-8">Be the first to leave a review!</p>'),void d.hide();h=Math.ceil(u.length/e),v<1&&(v=1),v>h&&(v=h);const a=(v-1)*e,s=a+e,n=u.slice(a,s);if(0===n.length&&u.length>0)return v=1,void g();n.forEach((e=>{const r=e.createdAt?moment(e.createdAt).format("MMM D, YYYY"):"Recently",a=e.name?e.name:"Anonymous",s=$(`\n        <article class="bg-neutral-darker p-6 rounded-lg shadow-lg border border-neutral-dark animate-fadeIn" style="opacity:1;">\n            <div class="flex flex-col sm:flex-row justify-between sm:items-center mb-2 gap-2 sm:gap-4">\n                <h3 class="reviewer-name text-lg font-semibold text-white order-2 sm:order-1"></h3>\n                <div class="review-stars order-1 sm:order-2">\n                    ${function(e){let t="";for(let r=1;r<=5;r++)t+=r<=e?"★":'<span class="empty-star">★</span>';return`<div class="display-stars text-xl" aria-label="${e} out of 5 stars">${t}</div>`}(e.stars)}\n                </div>\n            </div>\n            <p class="review-text mb-3"></p> \x3c!-- Placeholder for review text --\x3e\n            <p class="review-date text-xs text-neutral-light/60 text-right"></p>\n        </article>\n    `);s.find(".reviewer-name").text(a);const n=s.find(".review-text");e.text?(n.text(e.text),n.removeClass("text-neutral-light/50 italic").addClass("text-neutral-light/80")):(n.text("No comment left."),n.removeClass("text-neutral-light/80").addClass("text-neutral-light/50 italic")),s.find(".review-date").text(`Reviewed: ${r}`),t.append(s)})),function(){if(h<=1)return void d.hide();m.text(`Page ${v} of ${h}`),c.prop("disabled",1===v),p.prop("disabled",v===h),d.show()}()}function w(){r.show(),t.empty(),d.hide(),fetch("/reviews").then((e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()})).then((e=>{u=e,v=1,g()})).catch((e=>{console.error("Error fetching reviews:",e),r.hide(),t.html('<p class="text-center text-red-400 py-8">Could not load reviews. Please try again later.</p>')}))}c.on("click",(function(){v>1&&(v--,g(),$("html, body").animate({scrollTop:t.offset().top-100},300))})),p.on("click",(function(){v<h&&(v++,g(),$("html, body").animate({scrollTop:t.offset().top-100},300))})),a.submit((function(e){e.preventDefault(),s.html("").removeClass("text-green-400 text-red-400"),i.text("");const t=$("#reviewerName").val().trim(),r=$('input[name="rating"]:checked').val(),d=$("#reviewText").val().trim();if(!r)return i.text("Please select a star rating."),s.html('<span class="text-red-400">Please correct the error below.</span>'),void $("html, body").animate({scrollTop:$(".star-rating").offset().top-150},300);l.text("Submitting..."),o.removeClass("hidden"),n.prop("disabled",!0).addClass("opacity-75 cursor-not-allowed");const c={name:t||null,stars:parseInt(r,10),text:d||null};fetch("/reviews",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}).then((e=>e.json().then((t=>({ok:e.ok,status:e.status,data:t}))))).then((({ok:e,status:t,data:r})=>{if(!e)throw{status:t,message:r.error||`Server responded with status: ${t}`};s.html(`\n                <div class="p-3 bg-green-600/20 border border-green-500 rounded-lg text-green-300 text-center">\n                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline -mt-1 mr-1" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>\n                    ${r.message||"Review submitted successfully!"}\n                </div>\n            `),a[0].reset(),$('input[name="rating"]').prop("checked",!1),setTimeout((()=>{w()}),1500),setTimeout((()=>{l.text("Submit Review"),o.addClass("hidden"),n.prop("disabled",!1).removeClass("opacity-75 cursor-not-allowed")}),1e3)})).catch((e=>{console.error("Error submitting review:",e);let t="An unexpected error occurred. Please try again.";var r;e&&e.message&&(t=e.message),s.html(`\n                <div class="p-3 bg-red-600/20 border border-red-500 rounded-lg text-red-300 text-center">\n                     <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline -mt-1 mr-1" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" /></svg>\n                     ${r=t,r?r.replace(/&/g,"&").replace(/</g,"<").replace(/>/g,">").replace(/"/g,'"').replace(/'/g,"'"):""}\n                </div>\n             `),l.text("Submit Review"),o.addClass("hidden"),n.prop("disabled",!1).removeClass("opacity-75 cursor-not-allowed")}))})),w()}));