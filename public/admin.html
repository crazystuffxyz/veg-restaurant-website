<!doctypehtml><html lang=en><meta charset=UTF-8><meta content="width=device-width,initial-scale=1"name=viewport><title>Admin - Review Management</title><script src=https://cdn.tailwindcss.com></script><style>.review-card p{margin-bottom:.5rem}.review-card p:last-child{margin-bottom:0}.review-card strong{font-weight:600;color:#4a5568}</style><body class="bg-gray-100 font-sans text-gray-800"><div class="container max-w-6xl md:p-8 mx-auto p-4"><h1 class="mb-6 border-b font-bold pb-3 text-3xl text-green-700">Admin - Review Management</h1><div class="hidden mb-6 p-4 rounded-md text-sm"id=message></div><div class="hidden my-4 text-gray-600"id=loading-pending><p>Loading pending reviews...</div><div class="hidden my-4 text-gray-600"id=loading-approved><p>Loading approved reviews...</div><div class="gap-8 grid grid-cols-1 lg:grid-cols-2"><section class="bg-white p-6 rounded-lg shadow-md"id=pending-reviews-section><h2 class="font-semibold mb-4 text-xl text-yellow-700">Pending Approval</h2><div id=pending-reviews-list><p class="italic text-gray-500">No pending reviews found.</div></section><section class="bg-white p-6 rounded-lg shadow-md"id=approved-reviews-section><h2 class="font-semibold mb-4 text-xl text-blue-700">Approved Reviews</h2><div id=approved-reviews-list><p class="italic text-gray-500">No approved reviews found.</div></section></div></div><script>const pendingListDiv=document.getElementById("pending-reviews-list"),approvedListDiv=document.getElementById("approved-reviews-list"),messageDiv=document.getElementById("message"),loadingPendingDiv=document.getElementById("loading-pending"),loadingApprovedDiv=document.getElementById("loading-approved");function showMessage(e,t="success"){messageDiv.textContent=e,messageDiv.className="p-4 mb-6 rounded-md text-sm "+("success"===t?"bg-green-100 border border-green-300 text-green-800":"error"===t?"bg-red-100 border border-red-300 text-red-800":"bg-blue-100 border border-blue-300 text-blue-800"),messageDiv.classList.remove("hidden"),setTimeout((()=>{messageDiv.classList.add("hidden"),messageDiv.textContent=""}),5e3)}function createReviewCard(e,t){const r=document.createElement("div");r.className="review-card border border-gray-200 p-4 mb-4 rounded-md bg-gray-50 shadow-sm",r.id=`review-${e.id}`;const n="‚≠ê".repeat(e.stars),s=new Date(e.createdAt).toLocaleString(),o=e.approvedAt?new Date(e.approvedAt).toLocaleString():"N/A";return r.innerHTML=`\n                <p><strong>ID:</strong> <code class="text-xs bg-gray-200 px-1 rounded">${e.id}</code></p>\n                <p><strong>Name:</strong> ${e.name||'<span class="italic text-gray-500">Anonymous</span>'}</p>\n                <p><strong>Stars:</strong> <span title="${e.stars} stars">${n}</span> (${e.stars})</p>\n                <p><strong>Text:</strong> ${e.text||'<span class="italic text-gray-500">No text provided</span>'}</p>\n                <p><strong>Submitted:</strong> ${s}</p>\n                ${t?"":`<p><strong>Approved:</strong> ${o}</p>`}\n                <div class="review-actions mt-3 flex flex-wrap gap-2">\n                    ${t?`\n                        <button class="approve-btn px-3 py-1 bg-green-500 text-white rounded hover:bg-green-600 text-sm font-medium transition duration-150 ease-in-out" onclick="approveReview('${e.id}')">Approve</button>\n                        <button class="reject-btn px-3 py-1 bg-orange-500 text-white rounded hover:bg-orange-600 text-sm font-medium transition duration-150 ease-in-out" onclick="rejectReview('${e.id}')">Reject</button>\n                    `:`\n                        <button class="delete-btn px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 text-sm font-medium transition duration-150 ease-in-out" onclick="deleteApprovedReview('${e.id}')">Delete Approved</button>\n                    `}\n                </div>\n            `,r}async function fetchPendingReviews(){loadingPendingDiv.classList.remove("hidden"),pendingListDiv.innerHTML="";try{const e=await fetch("/admin/api/reviews/pending");if(!e.ok)throw new Error(`HTTP error ${e.status}`);const t=await e.json();0===t.length?pendingListDiv.innerHTML='<p class="text-gray-500 italic">No reviews currently awaiting approval.</p>':t.forEach((e=>{pendingListDiv.appendChild(createReviewCard(e,!0))}))}catch(e){console.error("Error fetching pending reviews:",e),showMessage(`Error loading pending reviews: ${e.message}`,"error"),pendingListDiv.innerHTML='<p class="text-red-600">Could not load pending reviews.</p>'}finally{loadingPendingDiv.classList.add("hidden")}}async function fetchApprovedReviews(){loadingApprovedDiv.classList.remove("hidden"),approvedListDiv.innerHTML="";try{const e=await fetch("/admin/api/reviews/approved");if(!e.ok)throw new Error(`HTTP error ${e.status}`);const t=await e.json();0===t.length?approvedListDiv.innerHTML='<p class="text-gray-500 italic">No approved reviews found.</p>':t.forEach((e=>{approvedListDiv.appendChild(createReviewCard(e,!1))}))}catch(e){console.error("Error fetching approved reviews:",e),showMessage(`Error loading approved reviews: ${e.message}`,"error"),approvedListDiv.innerHTML='<p class="text-red-600">Could not load approved reviews.</p>'}finally{loadingApprovedDiv.classList.add("hidden")}}async function approveReview(e){try{const t=await fetch(`/admin/api/reviews/approve/${e}`,{method:"POST"});if(!t.ok)throw new Error(`Failed to approve. Status: ${t.status}`);showMessage((await t.json()).message,"success");const r=document.getElementById(`review-${e}`);r&&r.remove(),fetchPendingReviews(),fetchApprovedReviews()}catch(e){console.error("Error approving review:",e),showMessage(`Error: ${e.message}`,"error")}}async function rejectReview(e){if(confirm("Are you sure you want to REJECT and permanently DELETE this pending review? This cannot be undone."))try{const t=await fetch(`/admin/api/reviews/reject/${e}`,{method:"DELETE"});if(!t.ok)throw new Error(`Failed to reject. Status: ${t.status}`);showMessage((await t.json()).message,"success");const r=document.getElementById(`review-${e}`);r&&r.remove(),0===pendingListDiv.children.length&&(pendingListDiv.innerHTML='<p class="text-gray-500 italic">No reviews currently awaiting approval.</p>')}catch(e){console.error("Error rejecting review:",e),showMessage(`Error: ${e.message}`,"error")}}async function deleteApprovedReview(e){if(confirm("Are you sure you want to permanently DELETE this APPROVED review? It will be removed from the public site. This cannot be undone."))try{const t=await fetch(`/admin/api/reviews/approved/delete/${e}`,{method:"DELETE"});if(!t.ok)throw new Error(`Failed to delete approved review. Status: ${t.status}`);showMessage((await t.json()).message,"success");const r=document.getElementById(`review-${e}`);r&&r.remove(),0===approvedListDiv.children.length&&(approvedListDiv.innerHTML='<p class="text-gray-500 italic">No approved reviews found.</p>')}catch(e){console.error("Error deleting approved review:",e),showMessage(`Error: ${e.message}`,"error")}}document.addEventListener("DOMContentLoaded",(()=>{fetchPendingReviews(),fetchApprovedReviews()}));</script>